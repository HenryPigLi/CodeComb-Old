@model IEnumerable<Clarification>
@{
    CodeComb.Entity.Contest contest = ViewBag.CurrentContest;
    ViewBag.Title = "Clar";
    var IsMaster = (bool)ViewBag.IsMaster;
    var IsCreator = (bool)ViewBag.IsCreator;
}

<div class="post-detail-body">
    <div class="cont-wrap">
        <div class="grid_12">
            <div class="post-detail-wrap-outer">
                <div class="profile-actions">
                    <a href="/Contest/@contest.ID" class="profile-btn"><img src="/Images/description.png" alt="比赛介绍" /></a>
                    @if (contest.Format != ContestFormat.OI && DateTime.Now >= contest.Begin || IsMaster)
                    {
                        <a href="/Contest/Standings/@contest.ID" class="profile-btn"><img src="/Images/standings.png" alt="比赛排名" /></a>
                        <a href="/Contest/Statistics/@contest.ID" class="profile-btn"><img src="/Images/statistics.png" alt="统计" /></a>

                    }
                    @if (DateTime.Now >= contest.Begin)
                    {
                        <a href="/Contest/Status/@contest.ID" class="profile-btn"><img src="/Images/status.png" alt="评测状态" /></a>
                        if (contest.Format == ContestFormat.Codeforces || contest.Format == ContestFormat.TopCoder)
                        {
                            <a href="/Contest/Hack/@contest.ID" class="profile-btn"><img src="/Images/hack.png" alt="Hack状态" /></a>
                        }
                        if (contest.AllowClarification)
                        {
                            <a href="/Contest/Clar/@contest.ID" class="profile-btn"><img src="/Images/clar.png" alt="答疑平台" /></a>
                        }
                        if (contest.AllowPrintRequest)
                        {
                            <a href="/Contest/Print/@contest.ID" class="profile-btn"><img src="/Images/print.png" alt="打印服务" /></a>
                        }
                    }
                    @if (IsMaster)
                    {
                        <a href="/Contest/Settings/General/@contest.ID" class="profile-btn"><img src="/Images/settings.png" alt="管理比赛" /></a>
                    }
                </div>
                <div class="post-detail-wrap">
                    <div class="post-title"><h2>答疑平台 - @contest.Title</h2></div>
                    <div class="post-info"></div>
                    <div class="post-content">
                        <h3>答疑记录</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Clar Id</th>
                                    <th>分类</th>
                                    <th>问题</th>
                                    <th>回答</th>
                                    <th>状态</th>
                                    @if (IsMaster)
                                    {
                                        <th>操作</th>
                                    }
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td>@item.ID</td>
                                        <td>@(item.ProblemID == null ? "General" : item.Problem.Title)</td>
                                        <td><a href="javascript:ShowClar(@item.ID)">@(item.Question.Length >= 20 ? item.Question.Substring(0, 17) + "..." : item.Question)</a></td>
                                        <td><a href="javascript:ShowClar(@item.ID)">@(item.Answer.Length >= 20 ? item.Answer.Substring(0, 17) + "..." : item.Answer)</a></td>
                                        <td>@item.Status.ToString()</td>
                                        @if (IsMaster)
                                        {
                                            <td><a href="javascript:ClarResponse(@item.ID)">回复</a></td>
                                        }
                                    </tr>
                                }
                            </tbody>
                        </table>
                        <br />
                        <h3>提交问题</h3>
                        @if (User.Identity.IsAuthenticated)
                        {
                            using (Html.BeginForm("Clar", "Contest", FormMethod.Post, new { id = "frmCreateClar" }))
                            {
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" />
                                <textarea style="width:100%" name="question" class="textbox"></textarea>
                                <p>
                                    <input type="submit" value="提交问题" class="button button-def" />
                                    <select name="problem_id">
                                        <option value="">General</option>
                                        @{
                                            var i = 'A';
                                            foreach (CodeComb.Web.Models.View.ClarProblem item in ViewBag.Problems)
                                            {
                                                <option value="@item.ID">@(i++): @item.Title</option>
                                            }
                                        }
                                    </select>
                                    <input type="checkbox" id="chkBroadcast" />Broadcast
                                </p>
                            }
                        }
                        else
                        {
                            <p>登录后可以通过答疑平台向裁判发起问题。</p>
                        }
                    </div>
                </div>
            </div>
        </div><div class="clear"></div>
    </div>
</div>